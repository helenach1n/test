<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D æ£®æ—æ‰“çµéŠæˆ²</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; overflow: hidden; }
        #gameCanvas { display: block; }
        #ui {
            position: absolute; top: 0; left: 0; width: 100%; padding: 20px;
            color: white; pointer-events: none; z-index: 100;
        }
        .stats {
            display: flex; gap: 30px; background: rgba(0,0,0,0.7);
            padding: 15px 25px; border-radius: 10px; border: 2px solid #8b5a2b;
        }
        .stat-item { text-align: center; }
        .stat-label { font-size: 0.9rem; color: #b8e0b8; }
        .stat-value { font-size: 2rem; font-weight: bold; color: #f0c040; }
        #crosshair {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 20px; height: 20px; pointer-events: none; z-index: 90;
        }
        .crosshair-dot {
            position: absolute; width: 4px; height: 4px; background: #00ff00;
            border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        #startScreen, #gameOverScreen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 200;
        }
        .screen-content {
            text-align: center; max-width: 600px; padding: 40px;
            background: rgba(90,57,33,0.9); border-radius: 20px; border: 5px solid #f0c040;
        }
        h1 { color: #f0c040; font-size: 3rem; margin-bottom: 20px; }
        .button {
            background: #5a3921; color: white; border: 3px solid #8b5a2b;
            padding: 15px 40px; font-size: 1.2rem; border-radius: 10px;
            cursor: pointer; margin: 10px; transition: all 0.3s; pointer-events: auto;
        }
        .button:hover { background: #8b5a2b; transform: scale(1.05); }
        #gameOverScreen { display: none; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="ui">
        <div class="stats">
            <div class="stat-item"><div class="stat-label">åˆ†æ•¸</div><div class="stat-value" id="score">0</div></div>
            <div class="stat-item"><div class="stat-label">ç”Ÿå‘½å€¼</div><div class="stat-value" id="lives">3</div></div>
            <div class="stat-item"><div class="stat-label">æ™‚é–“</div><div class="stat-value" id="time">60</div></div>
        </div>
    </div>
    <div id="crosshair"><div class="crosshair-dot"></div></div>
    <div id="startScreen">
        <div class="screen-content">
            <h1>ğŸ¯ 3D æ£®æ—æ‰“çµéŠæˆ² ğŸ¯</h1>
            <p style="color: #b8e0b8; margin-bottom: 30px;">ä½¿ç”¨æ»‘é¼ ç„æº–ï¼Œé»æ“Šå°„æ“Šå‹•ç‰©ã€‚ç²å¾—é«˜åˆ†ï¼</p>
            <button class="button" id="startButton">é–‹å§‹éŠæˆ²</button>
        </div>
    </div>
    <div id="gameOverScreen">
        <div class="screen-content">
            <h1>éŠæˆ²çµæŸ</h1>
            <p style="color: #b8e0b8; margin-bottom: 20px;">æœ€çµ‚åˆ†æ•¸: <span id="finalScore" style="color:#f0c040;font-size:2rem;">0</span></p>
            <button class="button" id="restartButton">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        // åŸºæœ¬è®Šæ•¸
        let scene, camera, renderer, raycaster, mouse;
        let animals = [];
        let gameActive = false;
        let score = 0, lives = 3, timeLeft = 60;
        let gameTimer, animalTimer;

        // DOM å…ƒç´ 
        const scoreEl = document.getElementById('score');
        const livesEl = document.getElementById('lives');
        const timeEl = document.getElementById('time');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreEl = document.getElementById('finalScore');
        const startBtn = document.getElementById('startButton');
        const restartBtn = document.getElementById('restartButton');
        const canvas = document.getElementById('gameCanvas');

        // åˆå§‹åŒ– Three.js
        function init() {
            // å ´æ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);

            // ç›¸æ©Ÿ
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 20);
            camera.lookAt(0, 0, 0);

            // æ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ canvas });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;

            // å…‰ç·š
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(10, 20, 10);
            light.castShadow = true;
            scene.add(light);
            scene.add(new THREE.AmbientLight(0x404040));

            // åœ°é¢
            const ground = new THREE.Mesh(
                new THREE.PlaneGeometry(100, 100),
                new THREE.MeshLambertMaterial({ color: 0x3a7c3a })
            );
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // æ¨¹æœ¨
            for (let i = 0; i < 20; i++) {
                const tree = createTree();
                tree.position.set(Math.random() * 80 - 40, 0, Math.random() * 80 - 40);
                scene.add(tree);
            }

            // å°„ç·šæŠ•å°„
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // äº‹ä»¶ç›£è½
            window.addEventListener('resize', onWindowResize);
            canvas.addEventListener('click', onMouseClick);
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', restartGame);

            // é–‹å§‹å‹•ç•«
            animate();
        }

        function createTree() {
            const group = new THREE.Group();
            const trunk = new THREE.Mesh(
                new THREE.CylinderGeometry(0.3, 0.5, 3),
                new THREE.MeshLambertMaterial({ color: 0x8B4513 })
            );
            trunk.position.y = 1.5;
            trunk.castShadow = true;
            group.add(trunk);
            const leaves = new THREE.Mesh(
                new THREE.ConeGeometry(2, 4, 8),
                new THREE.MeshLambertMaterial({ color: 0x2E7D32 })
            );
            leaves.position.y = 4;
            leaves.castShadow = true;
            group.add(leaves);
            return group;
        }

        function createAnimal() {
            const types = ['deer', 'rabbit', 'bird'];
            const type = types[Math.floor(Math.random() * types.length)];
            let geometry, color;
            switch(type) {
                case 'deer': geometry = new THREE.BoxGeometry(1.5, 1, 1); color = 0x8B4513; break;
                case 'rabbit': geometry = new THREE.SphereGeometry(0.5); color = 0xFFFFFF; break;
                case 'bird': geometry = new THREE.ConeGeometry(0.4, 1); color = 0xFFD700; break;
            }
            const animal = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({ color }));
            animal.position.set(Math.random() * 60 - 30, 0.5, Math.random() * 60 - 30);
            animal.castShadow = true;
            animal.userData = { type, speed: Math.random() * 0.05 + 0.02 };
            scene.add(animal);
            animals.push(animal);
        }

        function updateAnimals() {
            animals.forEach(animal => {
                animal.position.x += Math.sin(Date.now() * 0.001) * animal.userData.speed;
                animal.position.z += Math.cos(Date.now() * 0.001) * animal.userData.speed;
                // é‚Šç•Œæª¢æŸ¥
                if (animal.position.x > 40 || animal.position.x < -40) animal.userData.speed *= -1;
                if (animal.position.z > 40 || animal.position.z < -40) animal.userData.speed *= -1;
            });
        }

        function onMouseClick(event) {
            if (!gameActive) return;
            // è¨ˆç®—æ»‘é¼ ä½ç½®
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(animals);
            if (intersects.length > 0) {
                const animal = intersects[0].object;
                scene.remove(animal);
                animals = animals.filter(a => a !== animal);
                score += 10;
                scoreEl.textContent = score;
                // å‰µå»ºæ–°å‹•ç‰©
                setTimeout(createAnimal, 500);
            } else {
                lives--;
                livesEl.textContent = lives;
                if (lives <= 0) endGame();
            }
        }

        function startGame() {
            gameActive = true;
            score = 0; lives = 3; timeLeft = 60;
            scoreEl.textContent = score;
            livesEl.textContent = lives;
            timeEl.textContent = timeLeft;
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            // æ¸…é™¤èˆŠå‹•ç‰©
            animals.forEach(a => scene.remove(a));
            animals = [];
            // å‰µå»ºåˆå§‹å‹•ç‰©
            for (let i = 0; i < 5; i++) createAnimal();
            // è¨ˆæ™‚å™¨
            gameTimer = setInterval(() => {
                timeLeft--;
                timeEl.textContent = timeLeft;
                if (timeLeft <= 0) endGame();
            }, 1000);
            // å‹•ç‰©ç”Ÿæˆå™¨
            animalTimer = setInterval(createAnimal, 3000);
        }

        function endGame() {
            gameActive = false;
            clearInterval(gameTimer);
            clearInterval(animalTimer);
            finalScoreEl.textContent = score;
            gameOverScreen.style.display = 'flex';
        }

        function restartGame() {
            endGame();
            setTimeout(startGame, 100);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            if (gameActive) updateAnimals();
            renderer.render(scene, camera);
        }

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
